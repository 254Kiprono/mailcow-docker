#!/bin/sh
# Mock redis-cli to automatically handle auth errors when external Redis has no password
/usr/bin/redis-cli "$@" 2>/tmp/redis_err
RET=$?
if grep -q "ERR AUTH" /tmp/redis_err; then
  # Strip -a and its password from arguments and retry
  ARGS=$(echo "$@" | sed -E 's/-a [^ ]+//g' | sed 's/--no-auth-warning//g')
  /usr/bin/redis-cli $ARGS
  RET=$?
fi
exit $RET
