#!/bin/bash
set -e

# Mailcow Environment Configuration
# This file sets the database credentials and other Mailcow-specific settings

# =============================================================================
# DATABASE CONFIGURATION (Using external hkup-db-service)
# =============================================================================
DBNAME=mailcow
DBUSER=mailco-user
DBPASS=pass1234!
DBROOT=rootpass123

# =============================================================================
# MAILCOW HOSTNAME
# =============================================================================
MAILCOW_HOSTNAME=mailcow.devsinkenya.com

# =============================================================================
# TIMEZONE
# =============================================================================
TZ=Africa/Nairobi

# =============================================================================
# REDIS CONFIGURATION (Using external redis-ec)
# =============================================================================
# Redis password (set to empty if redis-ec has no password)
REDISPASS=

# Redis replication settings (leave empty for standalone)
REDIS_SLAVEOF_IP=
REDIS_SLAVEOF_PORT=

# =============================================================================
# API KEYS (Generate on server: openssl rand -hex 16)
# =============================================================================
API_KEY=GENERATE_ON_SERVER
API_KEY_READ_ONLY=GENERATE_ON_SERVER
API_ALLOW_FROM=0.0.0.0/0

# =============================================================================
# SSL/TLS CONFIGURATION
# =============================================================================
# Let's Encrypt settings
SKIP_LETS_ENCRYPT=y
LE_STAGING=n
SKIP_IP_CHECK=y
SKIP_HTTP_VERIFICATION=n

# Additional domains for certificate (comma-separated)
ADDITIONAL_SAN=mail-admin.devsinkenya.com
AUTODISCOVER_SAN=y
ONLY_MAILCOW_HOSTNAME=n

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================
# IPv4 network (not used since we're on external network)
IPV4_NETWORK=172.22.1

# IPv6 (disabled for external network compatibility)
IPV6_NETWORK=fd4d:6169:6c63:6f77::
ENABLE_IPV6=false

# =============================================================================
# MAIL PORTS
# =============================================================================
SMTP_PORT=25
SMTPS_PORT=465
SUBMISSION_PORT=587
IMAP_PORT=143
IMAPS_PORT=993
POP_PORT=110
POPS_PORT=995
SIEVE_PORT=4190
SQL_PORT=127.0.0.1:13306
REDIS_PORT=127.0.0.1:7654
DOVEADM_PORT=127.0.0.1:19991

# HTTP/HTTPS (disabled - using nginx-ec proxy)
HTTP_PORT=80
HTTPS_PORT=443
HTTP_BIND=
HTTPS_BIND=

# =============================================================================
# MAILCOW FEATURES
# =============================================================================
SKIP_CLAMD=n
SKIP_OLEFY=n
SKIP_SOGO=n
SKIP_FTS=y
SKIP_UNBOUND_HEALTHCHECK=n
SOGO_EXPIRE_SESSION=480
MAILCOW_PASS_SCHEME=BLF-CRYPT
ALLOW_ADMIN_EMAIL_LOGIN=n
ACL_ANYONE=disallow

# =============================================================================
# ADVANCED SETTINGS
# =============================================================================
COMPOSE_PROJECT_NAME=mailcow-dockerized
MASTER=y
DEV_MODE=n
DEMO_MODE=n
WEBAUTHN_ONLY_TRUSTED_VENDORS=n
DOVECOT_MASTER_USER=
DOVECOT_MASTER_PASS=
MAILDIR_GC_TIME=7200
MAILDIR_SUB=
FTS_HEAP=512
FTS_PROCS=3
USE_WATCHDOG=n
WATCHDOG_NOTIFY_EMAIL=
WATCHDOG_NOTIFY_BAN=y
WATCHDOG_NOTIFY_START=y
WATCHDOG_SUBJECT=Watchdog ALERT
WATCHDOG_NOTIFY_WEBHOOK=
WATCHDOG_NOTIFY_WEBHOOK_BODY=
WATCHDOG_EXTERNAL_CHECKS=n
WATCHDOG_MYSQL_REPLICATION_CHECKS=n
WATCHDOG_VERBOSE=n
IP_BY_DOCKER_API=0
CHECK_UNBOUND=1
EXTERNAL_CHECKS_THRESHOLD=1
NGINX_THRESHOLD=5
UNBOUND_THRESHOLD=5
REDIS_THRESHOLD=5
MYSQL_THRESHOLD=5
MYSQL_REPLICATION_THRESHOLD=1
SOGO_THRESHOLD=3
POSTFIX_THRESHOLD=8
POSTFIX_TLSPOL_THRESHOLD=8
CLAMD_THRESHOLD=15
DOVECOT_THRESHOLD=12
DOVECOT_REPL_THRESHOLD=20
PHPFPM_THRESHOLD=5
RATELIMIT_THRESHOLD=1
FAIL2BAN_THRESHOLD=1
ACME_THRESHOLD=1
RSPAMD_THRESHOLD=5
OLEFY_THRESHOLD=5
MAILQ_THRESHOLD=20
MAILQ_CRIT=30
LOG_LINES=9999
CLUSTERMODE=
MAILCOW_REPLICA_IP=
DOVEADM_REPLICA_PORT=
SOGO_URL_ENCRYPTION_KEY=GENERATE_ON_SERVER
HTTP_REDIRECT=n
NGINX_USE_PROXY_PROTOCOL=n
TRUSTED_PROXIES=
SNAT_TO_SOURCE=n
SNAT6_TO_SOURCE=n
ADDITIONAL_SERVER_NAMES=
SPAMHAUS_DQS_KEY=
DISABLE_NETFILTER_ISOLATION_RULE=n
ENABLE_SSL_SNI=n
